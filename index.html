<!DOCTYPE html>
<html>
  <head>
    <title>fasster::useR2018</title>
    <meta charset="utf-8">
    <meta name="author" content="Mitchell O’Hara-Wild" />
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <link href="libs/vis/vis.min.css" rel="stylesheet" />
    <script src="libs/vis/vis.min.js"></script>
    <link href="libs/timeline/timevis.css" rel="stylesheet" />
    <script src="libs/timevis-binding/timevis.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="libs/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap/js/bootstrap.min.js"></script>
    <script src="libs/bootstrap/shim/html5shiv.min.js"></script>
    <script src="libs/bootstrap/shim/respond.min.js"></script>
    <link rel="stylesheet" href="libs/slides.css" type="text/css" />
    <link rel="stylesheet" href="libs/animate.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

class: inverse 



.title[fasster]
.sticker-float[![fasster](resources/fasster.png)]

## Forecasting multiple seasonality with state switching

.bottom[
### Mitchell O'Hara-Wild (&lt;svg style="height:0.8em;top:.04em;position:relative;fill:#1da1f2;" viewBox="0 0 512 512"&gt;&lt;path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/&gt;&lt;/svg&gt;[@mitchoharawild](https://twitter.com/mitchoharawild))
&lt;br&gt;
### July 13th 2018

### Slides @ [mitchelloharawild.com/useR18/](http://mitchelloharawild.com/useR18/)
]

---
class: center

.animated.fadeIn[
## Time-series data is changing

### More data, more often.

&lt;hr&gt;
]

---
class: center

## Time-series data is changing

### More data, more often.

&lt;hr&gt;

.animated.fadeIn[
## Complicated patterns emerge

.pull-left[
### Multiple seasonality
### Lots of data
]
.pull-right[
### Missing values
### Additional noise
]

&lt;hr&gt; 
]

---
class: center

## Time-series data is changing

### More data, more often.

&lt;hr&gt;

## Complicated patterns emerge

.pull-left[
### Multiple seasonality
### Lots of data
]
.pull-right[
### Missing values
### Additional noise
]

&lt;hr&gt; 

.animated.fadeIn[
## New tools are needed
.sticker[![tsibble](resources/tsibble.svg)]
.sticker[![fable](resources/fable.svg)]
.sticker[![fasster](resources/fasster.png)]
]

---
class: inverse, center, top

background-image: url(resources/electricity.jpeg)
background-size: cover

# Electricity demand

---

# Electricity demand
&lt;img src="figure/elecMonthly-1.svg" style="display: block; margin: auto;" /&gt;

---

# Electricity demand
&lt;img src="figure/elecDaily-1.svg" style="display: block; margin: auto;" /&gt;

---

# Electricity demand
&lt;img src="figure/elecPlot-1.svg" style="display: block; margin: auto;" /&gt;
---


# Models for multiple seasonality
<div id="htmlwidget-12277bf35dc820d3ea64" class="timevis html-widget" style="width:100%;height:250px;">
<div class="btn-group zoom-menu">
<button type="button" class="btn btn-default btn-lg zoom-in" title="Zoom in">+</button>
<button type="button" class="btn btn-default btn-lg zoom-out" title="Zoom out">-</button>
</div>
</div>
<script type="application/json" data-for="htmlwidget-12277bf35dc820d3ea64">{"x":{"items":[{"id":"1","content":"MSARIMA","start":"2000","group":"ss"},{"id":"2","content":"DSHW","start":"2003","group":"ss"},{"id":"3","content":"BATS/TBATS","start":"2010","group":"ss"},{"id":"4","content":"FASSTER","start":"2018","group":"ss"},{"id":"5","content":"MLR","start":"2000","group":"reg"},{"id":"6","content":"GAM","start":"2000","group":"reg"},{"id":"7","content":"Prophet","start":"2017","group":"reg"}],"groups":[{"id":"ss","content":"State Space"},{"id":"reg","content":"Regression"}],"showZoom":false,"zoomFactor":0.5,"fit":true,"options":{"zoomable":false,"showCurrentTime":false},"height":"250px","api":[]},"evals":[],"jsHooks":[]}</script>

&lt;table class="table"&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Model&lt;/th&gt;
      &lt;th&gt;Flexible&lt;/th&gt;
      &lt;th&gt;Speed&lt;/th&gt;
      &lt;th&gt;Exogenous Regressors&lt;/th&gt;
      &lt;th&gt;Accuracy&lt;/th&gt;
      &lt;th&gt;Decompose Components&lt;/th&gt;
      &lt;th&gt;Evolving Terms&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;State&amp;nbspSpace&lt;/td&gt;
      &lt;td class="danger"&gt;No&lt;/td&gt;
      &lt;td class="danger"&gt;Slow&lt;/td&gt;
      &lt;td class="danger"&gt;No&lt;/td&gt;
      &lt;td class="warning"&gt;Okay&lt;/td&gt;
      &lt;td class="success"&gt;Yes&lt;/td&gt;
      &lt;td class="success"&gt;Yes&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Regression&lt;/td&gt;
      &lt;td class="success"&gt;Yes&lt;/td&gt;
      &lt;td class="success"&gt;Fast&lt;/td&gt;
      &lt;td class="success"&gt;Yes&lt;/td&gt;
      &lt;td class="warning"&gt;Okay&lt;/td&gt;
      &lt;td class="danger"&gt;No&lt;/td&gt;
      &lt;td class="danger"&gt;No&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

.center[(this table is a *massive* generalisation)]

---
class: inverse

.sticker-float[![fasster](resources/fasster.png)]
# What is fasster?

### * **F**orecasting with **A**dditive **S**witching of **S**easonality, **T**rend &amp; **E**xogenous **R**egressors*

&lt;br&gt;

--

### A state space model that is:
.pull-left[
* ### Flexible
]
.pull-right[
* ### Fast
]

&lt;br&gt;
--

### With support for:
* ### Missing values
* ### Exogenous regressors
---

.sticker-float[![fable](resources/fable.svg)]

# Extending fable

**fasster** is the first extension of fable.

&lt;br&gt;

This allows fasster models to work with other features from the fable package.

* Consistent output and graphics
* Usable in combination forecasts

&lt;br&gt;

Uses formula based model specification:

.panel.panel-default[.panel-body.largecode[
t(y) ~ specials
]]

---

# Supported specials for fasster

&lt;table class="table" style="font-size: 26px; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Function &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Description &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; poly(n) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Polynomials &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; seas(s) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Seasonal factors &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; trig(s, q) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Seasonal fourier terms &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; ARMA(ar, ma) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; ARMA processes &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; %S% &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; State switching &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; xreg &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Exogenous regressors &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; custom() &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Custom dlm matrices &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
class: inverse

.sticker-float[![fasster](resources/fasster.png)]
# Modelling with fasster

---

# Modelling electricity demand


```r
elec_tr &lt;- tsibbledata::elecdemand %&gt;%
  filter(index &lt; ymd("2014-03-01"))
elec_tr
```

```
#&gt; # A tsibble: 2,832 x 4 [30MINUTE]
#&gt;    index               Demand WorkDay Temperature
#&gt;    &lt;dttm&gt;               &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;
#&gt;  1 2014-01-01 00:00:00   3.91       0        18.2
#&gt;  2 2014-01-01 00:30:00   3.67       0        17.9
#&gt;  3 2014-01-01 01:00:00   3.50       0        17.6
#&gt;  4 2014-01-01 01:30:00   3.34       0        16.8
#&gt;  5 2014-01-01 02:00:00   3.20       0        16.3
#&gt;  6 2014-01-01 02:30:00   3.10       0        16.6
#&gt;  7 2014-01-01 03:00:00   3.04       0        16.6
#&gt;  8 2014-01-01 03:30:00   3.01       0        16.7
#&gt;  9 2014-01-01 04:00:00   3.02       0        16.2
#&gt; 10 2014-01-01 04:30:00   3.03       0        16.6
#&gt; # ... with 2,822 more rows
```

---

# %S%: State switching

```r
y ~ DayType %S% (poly(1) + trig(48, 14))
```


&lt;img src="figure/switching-1.svg" style="display: block; margin: auto;" /&gt;

---

# Modelling electricity demand

&lt;img src="figure/unnamed-chunk-4-1.svg" style="display: block; margin: auto;" /&gt;


---


```r
elec_fit &lt;- elec_tr %&gt;%
  fasster(log(Demand) ~ WorkDay %S% (trig(48, 16) + poly(1)) + 
                        Temperature + Temperature^2)
elec_fit
```

```
#&gt; # A mable: 1 model [30MINUTE]
#&gt;   data                  model  
#&gt;   &lt;list&gt;                &lt;model&gt;
#&gt; 1 &lt;tsibble [2,832 × 4]&gt; FASSTER
```


---

# Components


```r
components(elec_fit)
```

```
#&gt; # A tsibble: 2,832 x 7 [30MINUTE]
#&gt;    index               Temperature `Temperature^2` `WorkDay_0/poly(… `WorkDay_0/trig(…
#&gt;    &lt;dttm&gt;                    &lt;dbl&gt;           &lt;dbl&gt;             &lt;dbl&gt;             &lt;dbl&gt;
#&gt;  1 2014-01-01 00:00:00     -0.0189        0.000512              1.55          -0.00826
#&gt;  2 2014-01-01 00:30:00     -0.0189        0.000512              1.55          -0.0826 
#&gt;  3 2014-01-01 01:00:00     -0.0189        0.000512              1.55          -0.118  
#&gt;  4 2014-01-01 01:30:00     -0.0189        0.000512              1.55          -0.167  
#&gt;  5 2014-01-01 02:00:00     -0.0188        0.000510              1.55          -0.198  
#&gt;  6 2014-01-01 02:30:00     -0.0186        0.000509              1.54          -0.227  
#&gt;  7 2014-01-01 03:00:00     -0.0187        0.000510              1.54          -0.244  
#&gt;  8 2014-01-01 03:30:00     -0.0187        0.000509              1.53          -0.249  
#&gt;  9 2014-01-01 04:00:00     -0.0195        0.000521              1.54          -0.250  
#&gt; 10 2014-01-01 04:30:00     -0.0184        0.000505              1.52          -0.232  
#&gt; # ... with 2,822 more rows, and 2 more variables: `WorkDay_1/poly(1)` &lt;dbl&gt;,
#&gt; #   `WorkDay_1/trig(48, 16)` &lt;dbl&gt;
```

---

# Components (Seasonality)

&lt;img src="figure/comp-plot1-1.svg" style="display: block; margin: auto;" /&gt;


---

# Forecasts (Electricity demand)

&lt;img src="figure/elecfc-1.svg" style="display: block; margin: auto;" /&gt;


---

# Interpolation

Insert missing value plots here, filled with fasster modelled fits
Visually compare with actual values

---

# Streaming data

Mention that new data can come in without refitting the model

&lt;img src="figure/stream_data-1.svg" style="display: block; margin: auto;" /&gt;
---


```r
elec_fit %&gt;%
  stream(head(elec_ts, 48*7)) %&gt;%
  forecast(tail(elec_ts, -48*7)) %&gt;%
  autoplot(level = NULL)
```

&lt;img src="figure/stream_fc-1.svg" style="display: block; margin: auto;" /&gt;


---
class: inverse, top

.sticker-float[![fasster](resources/fasster.png)]
&lt;br&gt;
.center[
# The fasster package
]


&lt;table class="table"&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Model&lt;/th&gt;
      &lt;th&gt;Flexible&lt;/th&gt;
      &lt;th&gt;Speed&lt;/th&gt;
      &lt;th&gt;Exogenous Regressors&lt;/th&gt;
      &lt;th&gt;Accuracy&lt;/th&gt;
      &lt;th&gt;Decompose Components&lt;/th&gt;
      &lt;th&gt;Evolving Terms&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;State&amp;nbspSpace&lt;/td&gt;
      &lt;td class="danger"&gt;No&lt;/td&gt;
      &lt;td class="danger"&gt;Slow&lt;/td&gt;
      &lt;td class="danger"&gt;No&lt;/td&gt;
      &lt;td class="warning"&gt;Okay&lt;/td&gt;
      &lt;td class="success"&gt;Yes&lt;/td&gt;
      &lt;td class="success"&gt;Yes&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Regression&lt;/td&gt;
      &lt;td class="success"&gt;Yes&lt;/td&gt;
      &lt;td class="success"&gt;Fast&lt;/td&gt;
      &lt;td class="success"&gt;Yes&lt;/td&gt;
      &lt;td class="warning"&gt;Okay&lt;/td&gt;
      &lt;td class="danger"&gt;No&lt;/td&gt;
      &lt;td class="danger"&gt;No&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;fasster&lt;/td&gt;
      &lt;td class="success"&gt;No&lt;/td&gt;
      &lt;td class="warning"&gt;Okay*&lt;/td&gt;
      &lt;td class="success"&gt;No&lt;/td&gt;
      &lt;td class="warning"&gt;Okay&lt;/td&gt;
      &lt;td class="success"&gt;Yes&lt;/td&gt;
      &lt;td class="success"&gt;Yes&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

.footnote[[*] Much faster than state space models, similar speed to prophet]

The **development** version can be installed from GitHub using:


```r
# install.packages("devtools")
devtools::install_github("mitchelloharawild/fasster")
```
    </textarea>
<script src="libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
